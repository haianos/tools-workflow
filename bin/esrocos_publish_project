#!/usr/bin/env python

from subprocess import call, STDOUT
import os
import sys
import git
from git import Repo

project_repo = Repo(os.getcwd())
assert not project_repo.bare

if call(["git", "branch"], stderr=STDOUT, stdout=open(os.devnull, 'w')) != 0:
  print "not a git repo"
  sys.exit()

# ASK FOR PROJECT NAME

project_name = ""
project_name = raw_input("Please enter the name of the project: ")
if project_name == "":
  print "entered empty string, quit.."
  sys.exit()
else: 
  print "project name: "+ project_name

# LOOK UP UNIVERSE PACKAGE SET IN AUTOPROJ/REMOTES

universe_path = os.environ['AUTOPROJ_CURRENT_ROOT'] + '/autoproj/remotes/esrocos.universe'

try:
  if os.path.isdir(universe_path):
    print "found universe package set"
  else:
    print "error: did not find universe package set, aborting..."
    sys.exit()
except KeyError as err:
  print "error: could not find autoproj root path - AUTOPROJ_CURRENT_ROOT not set"

# SAVE CURRENT DIRECTORY PATH AND SWITCH TO UNIVERSE DIR

os.chdir(universe_path)

# ASK FOR PROJECT TYPE (default CMAKE) AND WRITE TO FILE

project_type = ""
project_type = raw_input("Please enter the type of the project (default is cmake): ")
if project_type == "":
  project_type = "cmake"
else: 
  print "project type: "+ project_name

# ASK FOR CVS AND REMOTE URL

project_cvs = ""
project_cvs = raw_input("Please enter the cvs hoster of the project (default is github): ")
if project_cvs == "":
  project_cvs = "github"
else: 
  print "project type: "+ project_name

# NEW BRANCH OF UNIVERSE PACKAGE (named by PROJECT NAME)

universe_repo = Repo(os.getcwd())
assert not universe_repo.bare

git = universe_repo.git
git.checkout('HEAD', b="new_contrib_"+project_name)

# OPEN packages.autobuild AND source.yml 

try:
  with open("packages.autobuild", 'w') as autobuild_file, open("source.yml", 'w') as source_file :
    print "opened files"
except IOError as err:
  print "could not write to file, exit..."
  sys.exit()

# AND WRITE INFOS



# PUSH NEW UPSTREAM BRANCH

sys.exit() 

# EITHER GENERATE PULL REQUEST OR TELL USER TO DO SO
